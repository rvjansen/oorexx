# -*- rpm-spec -*-
BuildRoot:      @CPACK_PACKAGE_FILE_NAME@@CPACK_RPM_PACKAGE_COMPONENT_PART_PATH@
Summary:        @CPACK_RPM_PACKAGE_SUMMARY@
Name:           @CPACK_RPM_PACKAGE_NAME@@CPACK_RPM_PACKAGE_COMPONENT_PART_NAME@
Version:        @CPACK_RPM_PACKAGE_VERSION@
Release:        @CPACK_RPM_PACKAGE_RELEASE@
License:        @CPACK_RPM_PACKAGE_LICENSE@
Group:          @CPACK_RPM_PACKAGE_GROUP@
Vendor:         @CPACK_RPM_PACKAGE_VENDOR@
Requires:       @CPACK_RPM_PACKAGE_REQUIRES@
@TMP_RPM_URL@
@TMP_RPM_REQUIRES@
@TMP_RPM_PROVIDES@
@TMP_RPM_OBSOLETES@
@TMP_RPM_CONFLICTS@
@TMP_RPM_AUTOPROV@
@TMP_RPM_AUTOREQ@
@TMP_RPM_AUTOREQPROV@
@TMP_RPM_BUILDARCH@
@TMP_RPM_PREFIX@

#%#define _rpmdir @CPACK_RPM_DIRECTORY@
#%#define _rpmfilename @CPACK_RPM_FILE_NAME@.rpm
%define _unpackaged_files_terminate_build 0
#%#define _topdir @CPACK_RPM_DIRECTORY@
@TMP_RPM_SPEC_INSTALL_POST@
@CPACK_RPM_SPEC_MORE_DEFINE@
@CPACK_RPM_COMPRESSION_TYPE_TMP@

%description
@CPACK_RPM_PACKAGE_DESCRIPTION@

# This is a shortcutted spec file generated by CMake RPM generator
# we skip _install step because CPack does that for us.
# We do only save CPack installed tree in _prepr
# and then restore it in build.
%prep
mv $RPM_BUILD_ROOT "%{_topdir}/tmpBBroot"

%build

%install
if [ -e $RPM_BUILD_ROOT ];
then
  rm -rf $RPM_BUILD_ROOT
fi

mv %{_topdir}/tmpBBroot $RPM_BUILD_ROOT

# adding update-alternatives support
install -d $RPM_BUILD_ROOT%{_sysconfdir}/alternatives

touch $RPM_BUILD_ROOT%{_sysconfdir}/alternatives/rexx
touch $RPM_BUILD_ROOT%{_sysconfdir}/alternatives/rexx.1.gz
touch $RPM_BUILD_ROOT%{_sysconfdir}/alternatives/rxqueue
touch $RPM_BUILD_ROOT%{_sysconfdir}/alternatives/rxqueue.1.gz

#mv $RPM_BUILD_ROOT%{_bindir}/rexx %{buildroot}%{_bindir}/rexx-oorexx
#mv $RPM_BUILD_ROOT%{_mandir}/man1/rexx.1.gz %{buildroot}%{_mandir}/man1/rexx-oorexx.1.gz
#mv $RPM_BUILD_ROOT%{_bindir}/rxqueue %{buildroot}%{_bindir}/rxqueue-oorexx
#mv $RPM_BUILD_ROOT%{_mandir}/man1/rxqueue.1.gz %{buildroot}%{_mandir}/man1/rxqueue-oorexx.1.gz

ln -sf %{_sysconfdir}/alternatives/rexx $RPM_BUILD_ROOT%{_bindir}/rexx
ln -sf %{_sysconfdir}/alternatives/rexx.1.gz $RPM_BUILD_ROOT%{_mandir}/man1/rexx.1.gz
ln -sf %{_sysconfdir}/alternatives/rxqueue $RPM_BUILD_ROOT%{_bindir}/rxqueue
ln -sf %{_sysconfdir}/alternatives/rxqueue.1.gz $RPM_BUILD_ROOT%{_mandir}/man1/rxqueue.1.gz

%clean

%post
# Add update-alternatives
%{_sbindir}/update-alternatives --install %{_bindir}/rexx rexx %{_bindir}/rexx-oorexx 25 \
   --slave %{_bindir}/rxqueue rxqueue %{_bindir}/rxqueue-oorexx \
   --slave %{_mandir}/man1/rxqueue.1.gz rxqueue.1.gz %{_mandir}/man1/rxqueue-oorexx.1.gz \
   --slave %{_mandir}/man1/rexx.1.gz rexx.1.gz %{_mandir}/man1/rexx-oorexx.1.gz

%postun

%pre

%preun
#remove update-alternatives
if [ ! -f %{_bindir}/rexx ] ; then
   %{_sbindir}/update-alternatives --remove rexx %{_bindir}/rexx-oorexx
fi

%files
%defattr(-,root,root,-)

%{_bindir}/rexx
%{_bindir}/rexx-oorexx
%{_bindir}/rxapi
%{_bindir}/rexxc
%{_bindir}/rxqueue
%{_bindir}/rxqueue-oorexx
%{_bindir}/rxsubcom
%{_bindir}/rxregexp.cls
%{_bindir}/rxftp.cls
%{_bindir}/csvStream.cls
%{_bindir}/json.cls
%{_bindir}/socket.cls
%{_bindir}/streamsocket.cls
%{_bindir}/mime.cls
%{_bindir}/smtp.cls
%{_bindir}/rexxtry.rex
%{_bindir}/callrexx1
%{_bindir}/callrexx2
%{_bindir}/libwpipe1.so
%{_bindir}/libwpipe2.so
%{_bindir}/libwpipe3.so
%{_bindir}/oorexx-config

%{_libdir}/librexxapi.so.5.0.0
%{_libdir}/librexxapi.so
%{_libdir}/librexxapi.so.3
%{_libdir}/librexxapi.so.4
%{_libdir}/librexx.so.5.0.0
%{_libdir}/librexx.so
%{_libdir}/librexx.so.3
%{_libdir}/librexx.so.4
%{_libdir}/rexx.img
%{_libdir}/librxmath.so.5.0.0
%{_libdir}/librxmath.so
%{_libdir}/librxmath.so.3
%{_libdir}/librxmath.so.4
%{_libdir}/librxsock.so.5.0.0
%{_libdir}/librxsock.so
%{_libdir}/librxsock.so.3
%{_libdir}/librxsock.so.4
%{_libdir}/librxregexp.so.5.0.0
%{_libdir}/librxregexp.so
%{_libdir}/librxregexp.so.3
%{_libdir}/librxregexp.so.4
%{_libdir}/libhostemu.so.5.0.0
%{_libdir}/libhostemu.so
%{_libdir}/libhostemu.so.3
%{_libdir}/libhostemu.so.4
%{_libdir}/librxunixsys.so.5.0.0
%{_libdir}/librxunixsys.so
%{_libdir}/librxunixsys.so.3
%{_libdir}/librxunixsys.so.4
%{_includedir}/rexx.h
%{_includedir}/rexxapidefs.h
%{_includedir}/rexxapitypes.h
%{_includedir}/rexxplatformapis.h
%{_includedir}/rexxplatformdefs.h
%{_includedir}/oorexxapi.h
%{_includedir}/oorexxerrors.h

%dir %{_datadir}/ooRexx
%dir %{_datadir}/ooRexx/native.api
%{_datadir}/ooRexx/rexxcps.rex
%{_datadir}/ooRexx/ccreply.rex
%{_datadir}/ooRexx/greply.rex
%{_datadir}/ooRexx/guess.rex
%{_datadir}/ooRexx/ktguard.rex
%{_datadir}/ooRexx/makestring.rex
%{_datadir}/ooRexx/month.rex
%{_datadir}/ooRexx/philfork.rex
%{_datadir}/ooRexx/properties.rex
%{_datadir}/ooRexx/qdate.rex
%{_datadir}/ooRexx/qtime.rex
%{_datadir}/ooRexx/scclient.rex
%{_datadir}/ooRexx/scserver.rex
%{_datadir}/ooRexx/sfclient.rex
%{_datadir}/ooRexx/sfserver.rex
%{_datadir}/ooRexx/stack.rex
%{_datadir}/ooRexx/usecomp.rex
%{_datadir}/ooRexx/usepipe.rex
%{_datadir}/ooRexx/arithmeticEvaluation.rex
%{_datadir}/ooRexx/arrayCallback.rex
%{_datadir}/ooRexx/concurrency.rex
%{_datadir}/ooRexx/constrained.rex
%{_datadir}/ooRexx/timezone.rex
%{_datadir}/ooRexx/delegation.rex
%{_datadir}/ooRexx/dynamicMethod.rex
%{_datadir}/ooRexx/interface.rex
%{_datadir}/ooRexx/singleLinkedList.rex
%{_datadir}/ooRexx/sortComposite.rex
%{_datadir}/ooRexx/synchronousConcurrency.rex
%{_datadir}/ooRexx/treeTraversal.rex
%{_datadir}/ooRexx/usetree.rex
%{_datadir}/ooRexx/complex.cls
%{_datadir}/ooRexx/pipe.cls
%{_datadir}/ooRexx/semcls.cls
%{_datadir}/ooRexx/treeDirectory.cls
%{_datadir}/ooRexx/jabberwocky.txt
%{_datadir}/ooRexx/rexx.sh
%{_datadir}/ooRexx/rexx.csh
%{_datadir}/ooRexx/readme
%{_datadir}/applications/rexxtry.desktop

%{_datadir}/icons/hicolor/48x48/apps/oorexx.png

%{_datadir}/ooRexx/native.api/stackOverflow
%{_datadir}/ooRexx/native.api/stackOverflow.cpp
%{_datadir}/ooRexx/native.api/runRexxProgram
%{_datadir}/ooRexx/native.api/runRexxProgram.cpp
%{_datadir}/ooRexx/native.api/HelloWorld.rex
%{_datadir}/ooRexx/native.api/backward.fnc
%{_datadir}/ooRexx/native.api/tooRecursiveTrapped.rex
%{_datadir}/ooRexx/native.api/tooRecursiveUnhandled.rex
%{_datadir}/ooRexx/native.api/ReadMe.txt
%{_datadir}/ooRexx/native.api/Makefile.linux

%{_mandir}/man1/rexxc.1.gz
%{_mandir}/man1/rxsubcom.1.gz
%{_mandir}/man1/rexx.1.gz
%{_mandir}/man1/rexx-oorexx.1.gz
%{_mandir}/man1/rxqueue-oorexx.1.gz
%{_mandir}/man1/rxqueue.1.gz
#
# placemarkers for update-alternatives
#
%ghost %{_sysconfdir}/alternatives/rexx
%ghost %{_sysconfdir}/alternatives/rexx.1.gz
%ghost %{_sysconfdir}/alternatives/rxqueue
%ghost %{_sysconfdir}/alternatives/rxqueue.1.gz

%changelog
@CPACK_RPM_SPEC_CHANGELOG@
